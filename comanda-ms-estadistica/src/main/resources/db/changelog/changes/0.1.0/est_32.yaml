databaseChangeLog:
  - changeSet:
      id: est-change-32-1
      author: limit
      changes:
        - addColumn:
            tableName: ${db_prefix}est_dimensio_valor
            columns:
              - column:
                  name: agrupable
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false
              - column:
                  name: valor_agrupacio
                  type: VARCHAR(255 ${varcharUnit})
        - addColumn:
            tableName: ${db_prefix}est_indicador
            columns:
              - column:
                  name: compactable
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false
              - column:
                  name: tipus_compactacio
                  type: VARCHAR(64 ${varcharUnit})
                  defaultValue: "SUMA"
              - column:
                  name: compactacio_indicador_id
                  type: bigint
        - addForeignKeyConstraint:
            baseTableName: ${db_prefix}est_indicador
            baseColumnNames: compactacio_indicador_id
            referencedTableName: ${db_prefix}est_indicador
            referencedColumnNames: id
            constraintName: ${db_prefix}ind_compactacio_fk
  - changeSet:
      id: est-change-32-2
      author: limit
      changes:
        - addColumn:
            tableName: ${db_prefix}est_fet
            columns:
              - column:
                  name: tipus
                  type: VARCHAR(64 ${varcharUnit})
                  defaultValue: "DIARI"
                  constraints:
                    nullable: false
              - column:
                  name: num_dies
                  type: int
                  defaultValueNumeric: 1
                  constraints:
                    nullable: false
  - changeSet:
      id: est-change-32-3
      author: limit
      changes:
        - createIndex:
            tableName: ${db_prefix}est_dimensio_valor
            indexName: ${db_prefix}est_dim_valor_dim_agr_idx
            columns:
              - column:
                  name: dimensio_id
              - column:
                  name: agrupable
        - createIndex:
            tableName: ${db_prefix}est_dimensio
            indexName: ${db_prefix}est_dim_entorn_idx
            columns:
              - column:
                  name: entorn_app_id
