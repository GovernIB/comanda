openapi: 3.0.3
info:
  title: comanda-api-interna
  version: 0.1.0
servers:
- url: ""
tags:
- description: "Contracte per a la gestió CRUD de permisos a Comanda (informació dels\
    \ permisos configurats a les aplicacions). Les peticions rebudes per aquest servei\
    \ es processaran asíncronament, de manera que en cap cas es rebrà una resposta\
    \ amb el resultat de l'operació com a resposta de les peticions."
  name: APP → COMANDA / Permisos
paths:
  /v1/permisos:
    delete:
      description: Afegeix múltiples missatges d'eliminació de permisos a una cua
        de events per a que s'eliminin aquests de forma asíncrona a Comanda.
      operationId: eliminarPermisos
      requestBody:
        content:
          application/json:
            schema:
              items:
                $ref: "#/components/schemas/Permis"
              type: array
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: successful operation
      summary: Eliminació de permisos
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: eliminarPermisos
      x-content-type: application/json
      x-accepts:
      - text/plain
    post:
      description: Afegeix un missatge d'alta de permís a una cua de events per a
        que es crei aquest de forma asíncrona a Comanda.
      operationId: crearPermis
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Permis"
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: successful operation
      summary: Creació d'un permís
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: crearPermis
      x-content-type: application/json
      x-accepts:
      - text/plain
  /v1/permisos/multiple:
    post:
      description: Afegeix múltiples missatges d'alta de permisos a una cua de events
        per a que es creïn aquests de forma asíncrona a Comanda.
      operationId: crearMultiplesPermisos
      requestBody:
        content:
          application/json:
            schema:
              items:
                $ref: "#/components/schemas/Permis"
              type: array
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: successful operation
      summary: Creació de múltiples permisos
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: crearMultiplesPermisos
      x-content-type: application/json
      x-accepts:
      - text/plain
    put:
      description: "Es comprova si els permisos existeixen, i en cas afirmatiu, s'afegeixen\
        \ múltiples missatges de modificació de permisos a una cua de events per a\
        \ que es modifiquin aquests de forma asíncrona a Comanda. Els permisos no\
        \ existents s'ignoren."
      operationId: modificarMultiplesPermisos
      requestBody:
        content:
          application/json:
            schema:
              items:
                $ref: "#/components/schemas/Permis"
              type: array
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: successful operation
      summary: Modificació de múltiples permisos
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: modificarMultiplesPermisos
      x-content-type: application/json
      x-accepts:
      - text/plain
  /v1/permisos/{identificador}:
    get:
      description: "Obté les dades d'un permís identificat pel seu identificador,\
        \ codi d'aplicació i codi d'entorn."
      operationId: consultarPermis
      parameters:
      - description: Identificador del permís
        explode: false
        in: path
        name: identificador
        required: true
        schema:
          type: string
        style: simple
      - description: Codi de l'aplicació
        explode: true
        in: query
        name: appCodi
        required: true
        schema:
          type: string
        style: form
      - description: Codi de l'entorn
        explode: true
        in: query
        name: entornCodi
        required: true
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Permis"
          description: successful operation
      summary: Consulta d'un permís
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: consultarPermis
      x-accepts:
      - application/json
    put:
      description: "Es comprova si el permís existeix, i en cas afirmatiu, s'afegeix\
        \ un missatge de modificació de permís a una cua de events per a que es modifiqui\
        \ aquest de forma asíncrona a Comanda."
      operationId: modificarPermis
      parameters:
      - description: Identificador funcional (objecte.identificador)
        explode: false
        in: path
        name: identificador
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Permis"
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: successful operation
      summary: Modificació d'un permís existent
      tags:
      - APP → COMANDA / Permisos
      x-operation-name: modificarPermis
      x-content-type: application/json
      x-accepts:
      - text/plain
components:
  schemas:
    Objecte:
      description: Objecte funcional sobre el qual s'apliquen permisos
      example:
        tipus: EXPEDIENT
        nom: EXP-12345/2025
        identificador: "12345"
      properties:
        tipus:
          description: Tipus d'objecte
          example: EXPEDIENT
          type: string
        nom:
          description: Nom o títol de l'objecte
          example: EXP-12345/2025
          type: string
        identificador:
          description: Identificador únic de l'objecte
          example: "12345"
          type: string
      type: object
    Permis:
      description: Sol·licitud de permisos per a un usuari o grup sobre un objecte
      example:
        objectesHereus:
        - tipus: EXPEDIENT
          nom: EXP-12345/2025
          identificador: "12345"
        - tipus: EXPEDIENT
          nom: EXP-12345/2025
          identificador: "12345"
        usuari:
          nif: 12345678Z
          nom: Anna Serra
          email: anna.serra@example.org
          codi: usr1234
        entornCodi: DEV
        objecte:
          tipus: EXPEDIENT
          nom: EXP-12345/2025
          identificador: "12345"
        grup: GESTORS
        appCodi: PORTAFIB
        permisos: "[\"LECTURA\", \"ESCRIPTURA\"]"
      properties:
        appCodi:
          description: Codi de l'aplicació que sol·licita el permís
          example: PORTAFIB
          type: string
        entornCodi:
          description: Codi de l'entorn de l'aplicació
          example: DEV
          type: string
        usuari:
          $ref: "#/components/schemas/Usuari"
        grup:
          description: Grup al qual s'aplica el permís
          example: GESTORS
          type: string
        permisos:
          description: Llista de permisos sol·licitats
          example: "[\"LECTURA\", \"ESCRIPTURA\"]"
          items:
            type: string
          type: array
        objecte:
          $ref: "#/components/schemas/Objecte"
        objectesHereus:
          description: Objectes hereus als quals també s'apliquen els permisos
          items:
            $ref: "#/components/schemas/Objecte"
          type: array
      type: object
    Usuari:
      description: Dades bàsiques d'un usuari
      example:
        nif: 12345678Z
        nom: Anna Serra
        email: anna.serra@example.org
        codi: usr1234
      properties:
        codi:
          description: Codi únic de l'usuari
          example: usr1234
          type: string
        nom:
          description: Nom complet de l'usuari
          example: Anna Serra
          type: string
        nif:
          description: NIF/NIE de l'usuari
          example: 12345678Z
          type: string
        email:
          description: Correu electrònic
          example: anna.serra@example.org
          type: string
      type: object

