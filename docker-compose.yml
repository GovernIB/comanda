version: "3"

volumes:
  comanda_files:
    driver: local

services:
  comanda:
    image: comanda:0.0.1
    ports:
      - ${APP_PORT:-8080}:8080
      - ${DEBUG_PORT:-8787}:8787
      - ${MGM_PORT:-9990}:9990
    volumes:
      - comanda_files:/home/jboss/apps/comanda/files
    environment:
      - JBOSS_APP_NAME=${APP_NAME:-comanda}
      - JBOSS_DB_DRIVER=${DB_DRIVER:-oracle}
      - JBOSS_DB_URL=${DB_URL}
      - JBOSS_DB_USERNAME=${DB_USERNAME}
      - JBOSS_DB_PASSWORD=${DB_PASSWORD}
      - JBOSS_AUTH_URL=${AUTH_URL}
      - JBOSS_AUTH_REALM=${AUTH_REALM}
      - JBOSS_AUTH_CLIENTID=${AUTH_CLIENTID}
      - JBOSS_AUTH_CLIENTID_WS=${AUTH_CLIENTID_WS}
      - JBOSS_AUTH_CREDENTIAL_SECRET=${AUTH_AUTH_CREDENTIAL_SECRET}
      - JBOSS_MAIL_HOST=${MAIL_HOST}
      - JBOSS_MAIL_PORT=${MAIL_PORT}
      - JBOSS_MAIL_USERNAME=${MAIL_USERNAME}
      - JBOSS_MAIL_PASSWORD=${MAIL_PASSWORD}
      - JBOSS_MAIL_SSL=${MAIL_SSL}
      - JBOSS_MAIL_TLS=${MAIL_TLS}
      - JBOSS_PROXY_HOST=${PROXY_HOST:-}
      - JBOSS_PROXY_PORT=${PROXY_PORT:-}
      - spring.jpa.properties.hibernate.dialect=${HIBERNATE_DIALECT}
      - spring.security.oauth2.resourceserver.jwt.issuer-uri=${AUTH_URL}/realms/${AUTH_REALM}
      - es.caib.comanda.app.url=${APP_URL:-http://localhost:8080}
      - es.caib.comanda.front.prefix=${APP_URL:-}
      - VITE_API_PUBLIC_URL=${APP_URL:-http://localhost:8080}/comandafront/api
      - VITE_API_PRIVATE_URL=${APP_URL:-http://localhost:8080}/comandaback/api
      - VITE_AUTH_KEYCLOAK_URL=${AUTH_URL}
      - VITE_AUTH_KEYCLOAK_REALM=${AUTH_REALM}
      - VITE_AUTH_KEYCLOAK_CLIENTID=${AUTH_CLIENTID}
      - DEBUG=${DEBUG:-}
      - DEBUG_PORT=${DEBUG_HOST:-0.0.0.0:}${DEBUG_PORT:-8787}
    restart: always